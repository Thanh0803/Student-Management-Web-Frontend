{"remainingRequest":"/home/thanh/DOAN/vue-admin-frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/thanh/DOAN/vue-admin-frontend/src/views/admins/UploadExcelStudent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/thanh/DOAN/vue-admin-frontend/src/views/admins/UploadExcelStudent.vue","mtime":1639765574908},{"path":"/home/thanh/DOAN/vue-admin-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1638461276469},{"path":"/home/thanh/DOAN/vue-admin-frontend/node_modules/babel-loader/lib/index.js","mtime":1638461225625},{"path":"/home/thanh/DOAN/vue-admin-frontend/node_modules/cache-loader/dist/cjs.js","mtime":1638461276469},{"path":"/home/thanh/DOAN/vue-admin-frontend/node_modules/vue-loader/lib/index.js","mtime":1638461277198}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport XLSX from \"xlsx\";\nimport Vue from \"vue\";\nVue.use(XLSX);\nimport {\n  Upload,\n  Button,\n  ButtonGroup,\n  Main,\n  Table,\n  TableColumn,\n} from \"element-ui\";\n// import { event } from 'd3';\nimport { get, put, del, post } from \"../../services/services\";\nimport Notifications from '../../components/NotificationPlugin/Notifications.vue';\nVue.use(Button);\nVue.use(Upload);\nVue.use(ButtonGroup);\nVue.use(Main);\nVue.use(Table);\nVue.use(TableColumn);\nexport default {\n  components: { Notifications },\n  data() {\n    return {\n      limitUpload: 1,\n      fileTemp: null,\n      file: null,\n      fileName: null,\n      da: [],\n      fileList: [],\n      dalen: 0,\n    };\n  },\n  watch: {\n    \"$route.params.id\": function (id) {\n      this.handleUpload();\n    },    \n  },\n  methods: {\n      handlePreview(file) {\n        console.log(file);\n      },\n    handleChange(file, fileList) {\n      this.fileTemp = file.raw;\n      if (this.fileTemp) {\n        if (\n          this.fileTemp.type ==\n            \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\" ||\n          this.fileTemp.type == \"application/vnd.ms-excel\"\n        ) {\n          this.importfxx(this.fileTemp);\n        } else {\n          this.$message({\n            type: \"warning\",\n            message: \"Định dạng của tệp đính kèm là sai, vui lòng xóa nó và tải lên lại!\",\n          });\n        }\n      } else {\n        this.$message({\n          type: \"warning\",\n          message: \"Vui lòng tải lên tệp đính kèm！\",\n        });\n      }\n    },\n    handleExceed() {\n      this.$message({\n        type: \"warning\",\n        message: \"超出最大上传文件数量的限制！\",\n      });\n      return;\n    },\n    handleRemove() {\n      this.fileTemp = null;\n      this.da = null;\n      this.dalen = 0;\n      this.fileName = null\n      return this.$refs.table.reload;\n    },\n    importfxx(obj) {\n      let _this = this;\n      let inputDOM = this.$refs.inputer;\n      // 通过DOM取文件数据\n      console.log(\"obj name\",obj.name);\n      // this.file = event.currentTarget.files[0];\n      this.fileName = obj.name\n      this.file = obj;\n      var rABS = false; //是否将文件读取为二进制字符串\n      var f = this.file;\n      var reader = new FileReader();\n      //if (!FileReader.prototype.readAsBinaryString) {\n      FileReader.prototype.readAsBinaryString = function (f) {\n        var binary = \"\";\n        var rABS = false; //是否将文件读取为二进制字符串\n        var pt = this;\n        var wb; //读取完成的数据\n        var outdata;\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          var bytes = new Uint8Array(reader.result);\n          var length = bytes.byteLength;\n          for (var i = 0; i < length; i++) {\n            binary += String.fromCharCode(bytes[i]);\n          }\n          var XLSX = require(\"xlsx\");\n          if (rABS) {\n            wb = XLSX.read(btoa(fixdata(binary)), {\n              //手动转化\n              type: \"base64\",\n            });\n          } else {\n            wb = XLSX.read(binary, {\n              type: \"binary\",cellDates: true, dateNF: 'yyyy/mm/dd;@'\n            });\n          }\n          outdata = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{raw: false}); //outdata就是你想要的东西\n          // console.log('未处理的原始数据如下：');\n          console.log('outdata',outdata);\n          //此处可对数据进行处理\n          let arr = [];\n          outdata.map((v) => {\n            let obj = {};\n            let nameTemp = [];\n            // console.log(\"obj\", obj)\n            obj.fullname = v[\"Fullname\"];\n            obj.username = v[\"Username\"];\n            obj.email = v[\"Email\"];\n            obj.password = v[\"Password\"];\n            obj.phone = v[\"Telephone\"];\n            obj.gender = v[\"Gender\"];\n            obj.fatherName = v[\"FatherName\"];\n            obj.motherName = v[\"MotherName\"];\n            obj.fatherPhone = v[\"FatherPhone\"];\n            obj.motherPhone = v[\"MotherPhone\"];\n            obj.fatherCareer = v[\"FatherCareer\"];\n            obj.motherCareer = v[\"MotherCareer\"];\n            nameTemp = obj.email.split('@');\n            var birthdayTemp = v[\"Birthday\"];\n            console.log(\"XXX\", birthdayTemp)\n            var birthdayArray = birthdayTemp.split(\"/\");\n            var birthday = new Date(birthdayArray[2],birthdayArray[1],birthdayArray[0])\n            obj.birthdayYear = parseInt(birthdayArray[2]);\n            obj.birthdayMonth = birthday.getMonth();\n            obj.birthdayDate = birthday.getDate();\n            arr.push(obj);\n          });\n          _this.da = arr;\n          _this.dalen = arr.length;\n          console.log('data',_this.da )\n          console.log('dataleng',_this.dalen )\n          console.log('arr',arr )\n          return arr;\n        };\n        reader.readAsArrayBuffer(f);\n      };\n      // console.log(this.da)\n      if (rABS) {\n        reader.readAsArrayBuffer(f);\n      } else {\n        reader.readAsBinaryString(f);\n      }\n    },\n    handleUpload() {\n      // console.log(this.da);\n      let url = \"http://localhost:8000/api/admin/student/upload/\"+this.$route.params.id;\n\n      let payload = {\n        data: [],\n      };\n      payload.data = this.da;\n      console.log('payload',payload.data);\n      post(url, payload)\n        .then((res) => {\n          console.log(\"Respon\", res);\n        if(res.data.count <0){\n            this.showNotification(\"danger\",\"Học sinh thuộc lớp không có trong hệ thống\")\n        this.handleRemove();\n        }else\n        {\n          this.showNotification(\"success\",\"Đã lưu dữ liệu thành công\")\n        this.handleRemove();\n        }\n        })\n        .catch((err) => {\n        //   alert(err);\n        console.log(\"Respon\", err);\n        this.showNotification(\"danger\",\"Dữ liệu không hợp lệ\")\n        this.handleRemove();\n        });\n    },\n    showNotification(type,message){\n      this.$notify({\n              message:\n                message,\n              icon: \"add_alert\",\n              horizontalAlign: 'right',\n              verticalAlign: 'top',\n              type: type,\n            });\n    },\n  },\n  // mounted(file,fileList){\n  //   this.handleChange(file,fileList);\n  // }\n};\n",{"version":3,"sources":["UploadExcelStudent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UploadExcelStudent.vue","sourceRoot":"src/views/admins","sourcesContent":["<template>\n  <div>\n      <notifications></notifications>\n    <base-header class=\"pb-6 pb-8 pt-5 pt-md-8 bg-gradient-success\">\n      <!-- Card stats -->\n    </base-header>\n    <div>\n      <!--limit:最大上传数，on-exceed：超过最大上传数量时的操作  -->\n      <el-upload\n        v-if=\"dalen < 1\"\n        class=\"upload-demo\"\n        action=\"\"\n        :on-change=\"handleChange\"\n        :on-remove=\"handleRemove\"\n        :on-preview=\"handlePreview\"\n        :on-exceed=\"handleExceed\"\n        :limit=\"limitUpload\"\n        accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\n        :auto-upload=\"false\"\n        :file-list=\"fileList\"\n      >\n        <el-button size=\"small\" type=\"primary\" v-if=\"dalen < 1\">Tải tệp lên</el-button>\n        <!-- <div slot=\"tip\" class=\"el-upload__tip\">只 能 上 传 xlsx / xls 文 件</div> -->\n      </el-upload>\n\n      <!-- 数据展示 -->\n      <h1 class=\"title\">{{fileName}}</h1>\n      <el-main v-if=\"dalen > 0\">\n        <el-table :data=\"da\" ref=\"table\">\n          <!-- <el-table-column prop=\"code\" label=\"Code\"> </el-table-column> -->\n          <el-table-column prop=\"username\" label=\"Username\" min-width=\"100px\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"fullname\" label=\"FullName\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"phone\" label=\"Telephone\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"email\" min-width=\"130px\" label=\"Email\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"password\" min-width=\"130px\" label=\"Password\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"gender\" min-width=\"45px\" label=\"Gender\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"fatherName\" min-width=\"100px\" label=\"FatherName\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"motherName\" min-width=\"100px\" label=\"MotherName\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"fatherCareer\" min-width=\"100px\" label=\"FatherCareer\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"motherCareer\" min-width=\"100px\" label=\"MotherCareer\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"fatherPhone\" min-width=\"100px\" label=\"FatherPhone\" align=\"center\"> </el-table-column>\n          <el-table-column prop=\"motherPhone\" min-width=\"100px\" label=\"MotherPhone\" align=\"center\"> </el-table-column>\n        </el-table>\n      </el-main>\n      <div style=\"text-align: center;\">\n      <el-button type=\"success\" @click=\"handleUpload\" v-if=\"dalen > 0\" \n        >Hoàn thành</el-button\n      >\n      <el-button type=\"danger\" @click=\"handleRemove\" v-if=\"dalen > 0\" \n        >Huỷ</el-button\n      >\n      </div>\n\n    </div>\n  </div>\n</template>\n<script>\nimport XLSX from \"xlsx\";\nimport Vue from \"vue\";\nVue.use(XLSX);\nimport {\n  Upload,\n  Button,\n  ButtonGroup,\n  Main,\n  Table,\n  TableColumn,\n} from \"element-ui\";\n// import { event } from 'd3';\nimport { get, put, del, post } from \"../../services/services\";\nimport Notifications from '../../components/NotificationPlugin/Notifications.vue';\nVue.use(Button);\nVue.use(Upload);\nVue.use(ButtonGroup);\nVue.use(Main);\nVue.use(Table);\nVue.use(TableColumn);\nexport default {\n  components: { Notifications },\n  data() {\n    return {\n      limitUpload: 1,\n      fileTemp: null,\n      file: null,\n      fileName: null,\n      da: [],\n      fileList: [],\n      dalen: 0,\n    };\n  },\n  watch: {\n    \"$route.params.id\": function (id) {\n      this.handleUpload();\n    },    \n  },\n  methods: {\n      handlePreview(file) {\n        console.log(file);\n      },\n    handleChange(file, fileList) {\n      this.fileTemp = file.raw;\n      if (this.fileTemp) {\n        if (\n          this.fileTemp.type ==\n            \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\" ||\n          this.fileTemp.type == \"application/vnd.ms-excel\"\n        ) {\n          this.importfxx(this.fileTemp);\n        } else {\n          this.$message({\n            type: \"warning\",\n            message: \"Định dạng của tệp đính kèm là sai, vui lòng xóa nó và tải lên lại!\",\n          });\n        }\n      } else {\n        this.$message({\n          type: \"warning\",\n          message: \"Vui lòng tải lên tệp đính kèm！\",\n        });\n      }\n    },\n    handleExceed() {\n      this.$message({\n        type: \"warning\",\n        message: \"超出最大上传文件数量的限制！\",\n      });\n      return;\n    },\n    handleRemove() {\n      this.fileTemp = null;\n      this.da = null;\n      this.dalen = 0;\n      this.fileName = null\n      return this.$refs.table.reload;\n    },\n    importfxx(obj) {\n      let _this = this;\n      let inputDOM = this.$refs.inputer;\n      // 通过DOM取文件数据\n      console.log(\"obj name\",obj.name);\n      // this.file = event.currentTarget.files[0];\n      this.fileName = obj.name\n      this.file = obj;\n      var rABS = false; //是否将文件读取为二进制字符串\n      var f = this.file;\n      var reader = new FileReader();\n      //if (!FileReader.prototype.readAsBinaryString) {\n      FileReader.prototype.readAsBinaryString = function (f) {\n        var binary = \"\";\n        var rABS = false; //是否将文件读取为二进制字符串\n        var pt = this;\n        var wb; //读取完成的数据\n        var outdata;\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          var bytes = new Uint8Array(reader.result);\n          var length = bytes.byteLength;\n          for (var i = 0; i < length; i++) {\n            binary += String.fromCharCode(bytes[i]);\n          }\n          var XLSX = require(\"xlsx\");\n          if (rABS) {\n            wb = XLSX.read(btoa(fixdata(binary)), {\n              //手动转化\n              type: \"base64\",\n            });\n          } else {\n            wb = XLSX.read(binary, {\n              type: \"binary\",cellDates: true, dateNF: 'yyyy/mm/dd;@'\n            });\n          }\n          outdata = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]],{raw: false}); //outdata就是你想要的东西\n          // console.log('未处理的原始数据如下：');\n          console.log('outdata',outdata);\n          //此处可对数据进行处理\n          let arr = [];\n          outdata.map((v) => {\n            let obj = {};\n            let nameTemp = [];\n            // console.log(\"obj\", obj)\n            obj.fullname = v[\"Fullname\"];\n            obj.username = v[\"Username\"];\n            obj.email = v[\"Email\"];\n            obj.password = v[\"Password\"];\n            obj.phone = v[\"Telephone\"];\n            obj.gender = v[\"Gender\"];\n            obj.fatherName = v[\"FatherName\"];\n            obj.motherName = v[\"MotherName\"];\n            obj.fatherPhone = v[\"FatherPhone\"];\n            obj.motherPhone = v[\"MotherPhone\"];\n            obj.fatherCareer = v[\"FatherCareer\"];\n            obj.motherCareer = v[\"MotherCareer\"];\n            nameTemp = obj.email.split('@');\n            var birthdayTemp = v[\"Birthday\"];\n            console.log(\"XXX\", birthdayTemp)\n            var birthdayArray = birthdayTemp.split(\"/\");\n            var birthday = new Date(birthdayArray[2],birthdayArray[1],birthdayArray[0])\n            obj.birthdayYear = parseInt(birthdayArray[2]);\n            obj.birthdayMonth = birthday.getMonth();\n            obj.birthdayDate = birthday.getDate();\n            arr.push(obj);\n          });\n          _this.da = arr;\n          _this.dalen = arr.length;\n          console.log('data',_this.da )\n          console.log('dataleng',_this.dalen )\n          console.log('arr',arr )\n          return arr;\n        };\n        reader.readAsArrayBuffer(f);\n      };\n      // console.log(this.da)\n      if (rABS) {\n        reader.readAsArrayBuffer(f);\n      } else {\n        reader.readAsBinaryString(f);\n      }\n    },\n    handleUpload() {\n      // console.log(this.da);\n      let url = \"http://localhost:8000/api/admin/student/upload/\"+this.$route.params.id;\n\n      let payload = {\n        data: [],\n      };\n      payload.data = this.da;\n      console.log('payload',payload.data);\n      post(url, payload)\n        .then((res) => {\n          console.log(\"Respon\", res);\n        if(res.data.count <0){\n            this.showNotification(\"danger\",\"Học sinh thuộc lớp không có trong hệ thống\")\n        this.handleRemove();\n        }else\n        {\n          this.showNotification(\"success\",\"Đã lưu dữ liệu thành công\")\n        this.handleRemove();\n        }\n        })\n        .catch((err) => {\n        //   alert(err);\n        console.log(\"Respon\", err);\n        this.showNotification(\"danger\",\"Dữ liệu không hợp lệ\")\n        this.handleRemove();\n        });\n    },\n    showNotification(type,message){\n      this.$notify({\n              message:\n                message,\n              icon: \"add_alert\",\n              horizontalAlign: 'right',\n              verticalAlign: 'top',\n              type: type,\n            });\n    },\n  },\n  // mounted(file,fileList){\n  //   this.handleChange(file,fileList);\n  // }\n};\n</script>\n<style>\n.el-upload, .margin-center{\n  margin: 2.5rem 32.5rem;\n}\n.title{\n  margin: 2.5rem;\n  text-align: center;\n}\n.el-table .cell {\n    word-break: break-word;\n}\n</style>"]}]}